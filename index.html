<script>
var flashcounter;
var colors = [
    "black", "brown", "red", "orange", "yellow",
    "green", "blue", "purple", "grey", "white"
];
var sudoku = [ 
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0
];
var sudokuSolution = [ 
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0
];

var sudokuRow = [ 
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0
];

var sudokuCol = [ 
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0
];

var sudokuBox = [ 
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0
];

function userClick(id)
{
    var idstr="" + id;
	var idint = (idstr[0]-1)*9+(idstr[1]-1);
	var i=sudoku[idint];
	var isCorrectSolution=1;
	
	i=sudoku[idint];
	i=(i+1)%10;
    sudoku[idint]=i;
	updateUserInterface();
	
	for(i=0;i<81;i++) {
	    if(sudoku[i]!=sudokuSolution[i]) isCorrectSolution=0;
	}
	if(isCorrectSolution==1) {
	    flashcounter=50;
        setTimeout('flashBackground()',50);
	}
}
function flashBackground()
{
    document.body.style.backgroundColor=colors[flashcounter%10];
    flashcounter--;
	if(flashcounter<0) {
        setTimeout('main()',50);	
	} else {
        setTimeout('flashBackground()',50);
	}
}

function clearAllVariables()
{
    for(i=0;i<81;i++) {
        sudoku[i]=0;
        sudokuSolution[i]=0;
        sudokuRow[i]=0;
        sudokuCol[i]=0;
        sudokuBox[i]=0;
    }    
}
function idxBox(i)
{
    return (Math.floor(Math.floor(i/9)/3)*3 + Math.floor(Math.floor(i%9)/3));
}
function isPossible(i,c)
{
    return (sudokuRow[c*9+Math.floor(i/9)]==0 && sudokuCol[c*9+i%9]==0 && sudokuBox[c*9+idxBox(i)]==0);
}
function setSudoku(i,n)
{
	sudoku[i]=n+1;
	sudokuRow[n*9+Math.floor(i/9)]=n+1;
	sudokuCol[n*9+Math.floor(i%9)]=n+1;
	sudokuBox[n*9+idxBox(i)]=n+1;
}
function clearSudoku(i)
{
    var n=sudoku[i]-1;
	sudoku[i]=0;
	sudokuRow[n*9+Math.floor(i/9)]=0;
	sudokuCol[n*9+Math.floor(i%9)]=0;
	sudokuBox[n*9+idxBox(i)]=0;
}

function anySolution()
{
    var i=0;
	var c;
	var rv=false;
	for(;i<81 && sudoku[i]!=0;i++);
    if(i<81) {
   		for(c=0;c<9 && !rv;c++) {
   		    if(isPossible(i,c)) {
   			    setSudoku(i,c);
   			    rv=anySolution();
   				clearSudoku(i);
            }
  		}
    } else {
        rv=true;
    }
	return rv;
}
function anyDuplicateSolutions()
{
    var i;
	var c;
	var rv=false;
	for(i=0;i<81 && !rv;i++) {
	    if(sudoku[i]==0) {
			for(c=0;c<9 && !rv;c++) {
				if(isPossible(i,c) && sudokuSolution[i]!=(c+1)) {
					setSudoku(i,c);
					rv=anySolution();
					clearSudoku(i);
				}
			}
		}
	}
    return rv;
}
function resetSudoku()
{
	var i;
	var rnd;
	var stop;
	clearAllVariables();
	for(i=0;i<81;i++) {
		rnd=Math.floor(Math.random()*9);
		stop=0;
		while(!isPossible(i,rnd) && stop<10) {
			rnd=(rnd+1)%9;
			stop++;
		}
		if(stop<10) {
			setSudoku(i,rnd);
			sudokuSolution[i]=rnd+1;
		} else {
			clearAllVariables();
			i=-1;
		}
	}
    var rndtable = [ 0,1,2,3,4,5,6,7,8,9, 10,11,12,13,14,15,16,17,18,19, 20,21,22,23,24,25,26,27,28,29, 30,31,32,33,34,35,36,37,38,39, 40,41,42,43,44,45,46,47,48,49, 50,51,52,53,54,55,56,57,58,59,
	                 60,61,62,63,64,65,66,67,68,69, 70,71,72,73,74,75,76,77,78,79, 80 ];
    for(i=0;i<81;i++) {
		do {
			rnd=Math.floor(Math.random()*81);
		} while(rnd==i);
		c=rndtable[i];
		rndtable[i]=rndtable[rnd];
		rndtable[rnd]=c;
	}
    for(i=0;i<81;i++) {
		clearSudoku(rndtable[i]);
		if(anyDuplicateSolutions()) setSudoku(rndtable[i],sudokuSolution[rndtable[i]]-1);
	}
	updateUserInterface();
}


function oldResetSudoku()
{
    var rndSudoku = Math.floor(Math.random()*sudokuLibrarySize);
	var i;
	
	for(i=0;i<81;i++) {
	    sudoku[i]=sudokuLibrary[rndSudoku*162+i];
		sudokuSolution[i]=sudokuLibrary[rndSudoku*162+81+i];
	}
	updateUserInterface();
}



function updateUserInterface()
{
  var x, y, c;
  var id = "", index=0;
  for (y=1; y < 10; y++) {
    for (x=1; x < 10; x++) {
      id = "" + y.toString () + x.toString ();
	  index = (id[0]-1)*9+(id[1]-1);
	  c=sudoku[index];
      document.getElementById(id).style.backgroundColor=colors[c];
    }
  }
}
function main()
{
  document.body.style.backgroundColor="black";
  resetSudoku();
  updateUserInterface();
}
function start ()
{
  setTimeout('main()',999);
}
start ();
</script>
<Html>
  <Head>
  </Head>
  <Body bgcolor="000000">
    <Table border=0 width="100%" height="4%" align=center valign=top>
      <TR>
        <TD> 
        </TD>
      </TR>
    </Table>
    <Table border=1 width="96%" height="93%" align=center valign=center>
      <TR height="32%">
        <TD width="32%"> 
          <Table border=1 width="100%" height="100%">
            <TR>
              <TD id="11" onClick='userClick(11);'> &nbsp;
              </TD>
              <TD id="12" onClick='userClick(12);'> &nbsp;
              </TD>
              <TD id="13" onClick='userClick(13);'> &nbsp;
              </TD>
            </TR>
            <TR>
              <TD id="21" onClick='userClick(21);'> &nbsp;
              </TD>
              <TD id="22" onClick='userClick(22);'> &nbsp;
              </TD>
              <TD id="23" onClick='userClick(23);'> &nbsp;
              </TD>
            </TR>
            <TR>
              <TD id="31" onClick='userClick(31);'> &nbsp;
              </TD>
              <TD id="32" onClick='userClick(32);'> &nbsp;
              </TD>
              <TD id="33" onClick='userClick(33);'> &nbsp;
              </TD>
            </TR>
          </Table>
        </TD>
        <TD width="32%">
          <Table border=1 width="100%" height="100%">
            <TR>
              <TD id="14" onClick='userClick(14);'> &nbsp;
              </TD>
              <TD id="15" onClick='userClick(15);'> &nbsp;
              </TD>
              <TD id="16" onClick='userClick(16);'> &nbsp;
              </TD>
            </TR>
            <TR>
              <TD id="24" onClick='userClick(24);'> &nbsp;
              </TD>
              <TD id="25" onClick='userClick(25);'> &nbsp;
              </TD>
              <TD id="26" onClick='userClick(26);'> &nbsp;
              </TD>
            </TR>
            <TR>
              <TD id="34" onClick='userClick(34);'> &nbsp;
              </TD>
              <TD id="35" onClick='userClick(35);'> &nbsp;
              </TD>
              <TD id="36" onClick='userClick(36);'> &nbsp;
              </TD>
            </TR>
          </Table>
        </TD>
        <TD width="32%"> 
          <Table border=1 width="100%" height="100%">
            <TR>
              <TD id="17" onClick='userClick(17);'> &nbsp;
              </TD>
              <TD id="18" onClick='userClick(18);'> &nbsp;
              </TD>
              <TD id="19" onClick='userClick(19);'> &nbsp;
              </TD>
            </TR>
            <TR>
              <TD id="27" onClick='userClick(27);'> &nbsp;
              </TD>
              <TD id="28" onClick='userClick(28);'> &nbsp;
              </TD>
              <TD id="29" onClick='userClick(29);'> &nbsp;
              </TD>
            </TR>
            <TR>
              <TD id="37" onClick='userClick(37);'> &nbsp;
              </TD>
              <TD id="38" onClick='userClick(38);'> &nbsp;
              </TD>
              <TD id="39" onClick='userClick(39);'> &nbsp;
              </TD>
            </TR>
          </Table>
        </TD>
      </TR>
      <TR height="32%">
        <TD> 
          <Table border=1 width="100%" height="100%">
            <TR>
              <TD id="41" onClick='userClick(41);'> &nbsp;
              </TD>
              <TD id="42" onClick='userClick(42);'> &nbsp;
              </TD>
              <TD id="43" onClick='userClick(43);'> &nbsp;
              </TD>
            </TR>
            <TR>
              <TD id="51" onClick='userClick(51);'> &nbsp;
              </TD>
              <TD id="52" onClick='userClick(52);'> &nbsp;
              </TD>
              <TD id="53" onClick='userClick(53);'> &nbsp;
              </TD>
            </TR>
            <TR>
              <TD id="61" onClick='userClick(61);'> &nbsp;
              </TD>
              <TD id="62" onClick='userClick(62);'> &nbsp;
              </TD>
              <TD id="63" onClick='userClick(63);'> &nbsp;
              </TD>
            </TR>
          </Table>
        </TD>
        <TD> 
          <Table border=1 width="100%" height="100%">
            <TR>
              <TD id="44" onClick='userClick(44);'> &nbsp;
              </TD>
              <TD id="45" onClick='userClick(45);'> &nbsp;
              </TD>
              <TD id="46" onClick='userClick(46);'> &nbsp;
              </TD>
            </TR>
            <TR>
              <TD id="54" onClick='userClick(54);'> &nbsp;
              </TD>
              <TD id="55" onClick='userClick(55);'> &nbsp;
              </TD>
              <TD id="56" onClick='userClick(56);'> &nbsp;
              </TD>
            </TR>
            <TR>
              <TD id="64" onClick='userClick(64);'> &nbsp;
              </TD>
              <TD id="65" onClick='userClick(65);'> &nbsp;
              </TD>
              <TD id="66" onClick='userClick(66);'> &nbsp;
              </TD>
            </TR>
          </Table>
        </TD>
        <TD> 
          <Table border=1 width="100%" height="100%">
            <TR>
              <TD id="47" onClick='userClick(47);'> &nbsp;
              </TD>
              <TD id="48" onClick='userClick(48);'> &nbsp;
              </TD>
              <TD id="49" onClick='userClick(49);'> &nbsp;
              </TD>
            </TR>
            <TR>
              <TD id="57" onClick='userClick(57);'> &nbsp;
              </TD>
              <TD id="58" onClick='userClick(58);'> &nbsp;
              </TD>
              <TD id="59" onClick='userClick(59);'> &nbsp;
              </TD>
            </TR>
            <TR>
              <TD id="67" onClick='userClick(67);'> &nbsp;
              </TD>
              <TD id="68" onClick='userClick(68);'> &nbsp;
              </TD>
              <TD id="69" onClick='userClick(69);'> &nbsp;
              </TD>
            </TR>
          </Table>
        </TD>
      </TR>      
      <TR height="32%">
        <TD> 
          <Table border=1 width="100%" height="100%">
            <TR>
              <TD id="71" onClick='userClick(71);'> &nbsp;
              </TD>
              <TD id="72" onClick='userClick(72);'> &nbsp;
              </TD>
              <TD id="73" onClick='userClick(73);'> &nbsp;
              </TD>
            </TR>
            <TR>
              <TD id="81" onClick='userClick(81);'> &nbsp;
              </TD>
              <TD id="82" onClick='userClick(82);'> &nbsp;
              </TD>
              <TD id="83" onClick='userClick(83);'> &nbsp;
              </TD>
            </TR>
            <TR>
              <TD id="91" onClick='userClick(91);'> &nbsp;
              </TD>
              <TD id="92" onClick='userClick(92);'> &nbsp;
              </TD>
              <TD id="93" onClick='userClick(93);'> &nbsp;
              </TD>
            </TR>
          </Table>
        </TD>
        <TD> 
          <Table border=1 width="100%" height="100%">
            <TR>
              <TD id="74" onClick='userClick(74);'> &nbsp;
              </TD>
              <TD id="75" onClick='userClick(75);'> &nbsp;
              </TD>
              <TD id="76" onClick='userClick(76);'> &nbsp;
              </TD>
            </TR>
            <TR>
              <TD id="84" onClick='userClick(84);'> &nbsp;
              </TD>
              <TD id="85" onClick='userClick(85);'> &nbsp;
              </TD>
              <TD id="86" onClick='userClick(86);'> &nbsp;
              </TD>
            </TR>
            <TR>
              <TD id="94" onClick='userClick(94);'> &nbsp;
              </TD>
              <TD id="95" onClick='userClick(95);'> &nbsp;
              </TD>
              <TD id="96" onClick='userClick(96);'> &nbsp;
              </TD>
            </TR>
          </Table>
        </TD>
        <TD> 
          <Table border=1 width="100%" height="100%">
            <TR>
              <TD id="77" onClick='userClick(77);'> &nbsp;
              </TD>
              <TD id="78" onClick='userClick(78);'> &nbsp;
              </TD>
              <TD id="79" onClick='userClick(79);'> &nbsp;
              </TD>
            </TR>
            <TR>
              <TD id="87" onClick='userClick(87);'> &nbsp;
              </TD>
              <TD id="88" onClick='userClick(88);'> &nbsp;
              </TD>
              <TD id="89" onClick='userClick(89);'> &nbsp;
              </TD>
            </TR>
            <TR>
              <TD id="97" onClick='userClick(97);'> &nbsp;
              </TD>
              <TD id="98" onClick='userClick(98);'> &nbsp;
              </TD>
              <TD id="99" onClick='userClick(99);'> &nbsp;
              </TD>
            </TR>
          </Table>
        </TD>
      </TR>
    </Table>
  </Body>
</Html>
<script>
</script>
